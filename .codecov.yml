# Codecov configuration for Uptime Watcher
# See: https://docs.codecov.com/docs/codecov-yaml
# Optimized for Electron + React + TypeScript architecture with domain-driven design
# Updated for 2025 Codecov best practices

codecov:
    archive:
        uploads: true # Keep historical data for analytics

    branch: main
    max_report_age: "24h" # Modern syntax - reject reports older than 24 hours
    notify:
        manual_trigger: false # Explicit setting for modern CI/CD pipelines
        notify_error: true # Show upload failures in comments
        wait_for_ci: true
    require_ci_to_pass: true
comment:
    behavior: default
    hide_project_coverage: false

    layout: "header, flags, diff, tree, files, reach, betaprofiling, components, footer, feedback"
    require_base: false # Allow comments on first PR
    require_changes: false
    require_head: false # Require head report to comment
component_management:
    default_rules:
        statuses:
            - branches:
                  - "!main"
              target: auto
              threshold: 2%
              type: project
    individual_components:
        # === SHARED CORE (Global Coverage for Shared Folder) ===
        - component_id: shared_core
          name: "üß© Shared Core"
          paths:
              - shared/**
          statuses:
              - target: 90%
                threshold: 2%
                type: project
              - target: 80%
                threshold: 7%

                type: patch
        # === CORE BUSINESS LOGIC (Highest Coverage Requirements) ===

        - component_id: monitoring_core
          name: "üéØ Monitoring Core Engine"
          paths:
              - electron/services/monitoring/**
              - electron/managers/MonitorManager.ts
              - src/stores/sites/useSiteMonitoring.ts
              - shared/utils/monitoring/**
          statuses:
              - target: 95%
                threshold: 1%
                type: project
              - target: 90%
                threshold: 3%

                type: patch
        - component_id: database_layer
          name: "üóÑÔ∏è Database Layer"
          paths:
              - electron/services/database/**
              - electron/managers/DatabaseManager.ts
              - shared/types/database.ts
          statuses:
              - target: 95%
                threshold: 1%
                type: project
              - target: 90%
                threshold: 3%

                type: patch
        - component_id: orchestrator
          name: "üéº Uptime Orchestrator"
          paths:
              - electron/UptimeOrchestrator.ts
          statuses:
              - target: 95%
                threshold: 1%
                type: project
              - target: 90%
                threshold: 3%

                type: patch
        # === BUSINESS DOMAIN LOGIC (High Coverage Requirements) ===

        - component_id: site_management
          name: "üåê Site Management Domain"
          paths:
              - electron/managers/SiteManager.ts
              - src/stores/sites/useSiteOperations.ts
              - src/stores/sites/useSiteSync.ts
              - src/stores/sites/useSitesState.ts
              - shared/types/siteStatus.ts
          statuses:
              - target: 90%
                threshold: 2%
                type: project
              - target: 85%
                threshold: 5%

                type: patch
        - component_id: configuration_management
          name: "‚öôÔ∏è Configuration Management"
          paths:
              - electron/managers/ConfigurationManager.ts
              - src/stores/settings/**
              - shared/types/events.ts
          statuses:
              - target: 90%
                threshold: 2%
                type: project
              - target: 85%
                threshold: 5%

                type: patch
        - component_id: ipc_communication
          name: "üîó IPC Communication Layer"
          paths:
              - electron/services/ipc/**
              - electron/preload.ts
          statuses:
              - target: 85%
                threshold: 2%
                type: project
              - target: 80%
                threshold: 5%

                type: patch
        # === APPLICATION SERVICES (Medium-High Coverage) ===

        - component_id: backend_services
          name: "üîß Backend Services"
          paths:
              - electron/services/application/**
              - electron/services/security/**
              - electron/services/performance/**
              - electron/services/updater/**
          statuses:
              - target: 85%
                threshold: 3%
                type: project
              - target: 80%
                threshold: 7%

                type: patch
        - component_id: notification_system
          name: "üì¢ Notification System"
          paths:
              - electron/services/notifications/**
          statuses:
              - target: 80%
                threshold: 3%
                type: project
              - target: 75%
                threshold: 7%

                type: patch
        - component_id: window_management
          name: "ü™ü Window Management"
          paths:
              - electron/services/window/**
          statuses:
              - target: 80%
                threshold: 3%
                type: project
              - target: 75%
                threshold: 7%

                type: patch
        # === FRONTEND STATE MANAGEMENT (Medium Coverage) ===

        - component_id: frontend_stores
          name: "üì¶ Frontend State Stores"
          paths:
              - src/stores/error/**
              - src/stores/stats/**
              - src/stores/ui/**
              - src/stores/updates/**
              - shared/utils/errorHandling.ts
          statuses:
              - target: 80%
                threshold: 3%
                type: project
              - target: 75%
                threshold: 8%

                type: patch
        - component_id: business_hooks
          name: "ü™ù Business Logic Hooks"
          paths:
              - src/hooks/site/**
              - src/hooks/useBackendFocusSync.ts
              - src/hooks/useSelectedSite.ts
              - shared/utils/typeGuards.ts
          statuses:
              - target: 80%
                threshold: 3%
                type: project
              - target: 75%
                threshold: 8%

                type: patch
        # === FRONTEND UI COMPONENTS (Medium Coverage) ===

        - component_id: core_ui_components
          name: "üß© Core UI Components"
          paths:
              - src/components/Dashboard/**
              - src/components/SiteDetails/**
              - src/components/AddSiteForm/**
          statuses:
              - target: 75%
                threshold: 4%
                type: project
              - target: 70%
                threshold: 10%

                type: patch
        - component_id: common_ui_components
          name: "üîß Common UI Components"
          paths:
              - src/components/common/**
              - src/components/Header/**
              - src/components/Settings/**
          statuses:
              - target: 70%
                threshold: 5%
                type: project
              - target: 65%
                threshold: 12%

                type: patch
        # === FRONTEND INFRASTRUCTURE (Lower Coverage - Harder to Test) ===

        - component_id: theme_system
          name: "üé® Theme System"
          paths:
              - src/theme/**
              - shared/utils/stringConversion.ts
          statuses:
              - target: 65%
                threshold: 5%
                type: project
              - target: 60%
                threshold: 15%

                type: patch
        - component_id: frontend_services
          name: "üîå Frontend Services"
          paths:
              - src/services/**
          statuses:
              - target: 75%
                threshold: 4%
                type: project
              - target: 70%
                threshold: 10%

                type: patch
        # === UTILITIES AND HELPERS (High Coverage - Easy to Test) ===

        - component_id: backend_utilities
          name: "üõ†Ô∏è Backend Utilities"
          paths:
              - electron/utils/**
              - electron/electronUtils.ts
              - shared/utils/jsonSafety.ts
              - shared/utils/objectSafety.ts
          statuses:
              - target: 90%
                threshold: 2%
                type: project
              - target: 85%
                threshold: 5%

                type: patch
        - component_id: frontend_utilities
          name: "üß∞ Frontend Utilities"
          paths:
              - src/utils/**
              - shared/utils/**
          statuses:
              - target: 90%
                threshold: 2%
                type: project
              - target: 85%
                threshold: 5%

                type: patch
        # === TYPE DEFINITIONS AND CONSTANTS (Lower Priority) ===

        - component_id: type_system
          name: "üìù Type Definitions"
          paths:
              - src/types.ts
              - electron/types.ts
              - src/stores/types.ts
              - src/theme/types.ts
              - shared/types/**
          statuses:
              - target: 60%
                threshold: 8%
                type: project
              - target: 50%
                threshold: 20%

                type: patch
        - component_id: constants_config
          name: "üîß Constants & Configuration"
          paths:
              - src/constants.ts
              - electron/constants.ts
          statuses:
              - target: 60%
                threshold: 8%
                type: project
              - target: 50%
                threshold: 20%

                type: patch
        # === INTEGRATION POINTS (Special Monitoring) ===

        - component_id: integration_layer
          name: "üîó Integration Layer"
          paths:
              - electron/managers/validators/**
              - src/stores/middleware/**
              - electron/events/**
              - shared/validation/**
          statuses:
              - target: 85%
                threshold: 3%
                type: project
              - target: 80%
                threshold: 7%
                type: patch
coverage:
    ignore:
        # Build outputs and compiled files
        - "dist/**/*"
        - "**/dist/**/*"
        - "electron/dist/**/*"
        - "coverage/**/*"
        - "release/**/*"

        # Development and configuration files
        - "scripts/**/*"
        - "docs/**/*"
        - "**/*.config.*"
        - "**/*.d.ts"
        - "**/node_modules/**/*"
        - "vite.config.ts"
        - "vitest.config.ts"
        - "vitest.electron.config.ts"
        - "vitest.shared.config.ts"
        - "tsconfig*.json"
        - "eslint.config.mjs"
        - "tailwind.config.mjs"
        - "postcss.config.mjs"

        # Test files (don't test the tests)
        - "**/*.test.*"
        - "**/*.spec.*"
        - "**/test/**/*"
        - "src/test/**/*"
        - "electron/test/**/*"
        - "**/__tests__/**/*"
        - "**/tests/**/*"

        # Static assets and documentation
        - "public/**/*"
        - "icons/**/*"
        - "**/*.md"
        - "**/*.yml"
        - "**/*.yaml"
        - "**/*.json"
        - "_ZENTASKS/**/*"

        # Generated files
        - "**/*.generated.*"
        - "**/generated/**/*"
        - "src/types/api.ts" # Often auto-generated

        # Entry points (often just imports)
        - "src/main.tsx"
        - "electron/main.ts"
        - "**/index.ts" # Index files are usually just exports

    precision: 2
    range: "60...100" # More realistic range for complex Electron app

    round: down
    status:
        patch:
            default:
                only_pulls: false
                target: 65% # Realistic for new code
                threshold: 10%
            electron:
                flags:
                    - electron
                paths:
                    - "electron/"
                target: 70% # Backend should have higher coverage
                threshold: 10%
            frontend:
                flags:
                    - frontend
                paths:
                    - "src/"
                target: 60% # React components can be harder to test fully
                threshold: 15%
            shared:
                flags:
                    - shared
                paths:
                    - "shared/"

                target: 80% # Shared code should be well tested
                threshold: 10%
        project:
            default:
                base: auto
                if_ci_failed: error
                only_pulls: false
                target: auto
                threshold: 2% # Slightly more lenient for complex architecture
            electron:
                flags:
                    - electron
                paths:
                    - "electron/"
                target: 85% # Higher target for backend logic
                threshold: 2%
            frontend:
                flags:
                    - frontend
                paths:
                    - "src/"
                target: 75% # Realistic target for React components
                threshold: 3%
            shared:
                flags:
                    - shared
                paths:
                    - "shared/"
                target: 90% # High target for shared business logic
                threshold: 2%
flags:
    electron:
        carryforward: false
        ignore:
            - "electron/**/*.test.*"
            - "electron/**/*.spec.*"
            - "electron/test/**/*"
            - "electron/main.ts" # Entry point
        paths:
            - electron/
    frontend:
        carryforward: false
        ignore:
            - "src/**/*.test.*"
            - "src/**/*.spec.*"
            - "src/test/**/*"
            - "src/main.tsx" # Entry point
            - "src/index.css" # CSS file
        paths:
            - src/
    shared:
        carryforward: false
        ignore:
            - "shared/**/*.test.*"
            - "shared/**/*.spec.*"
            - "shared/test/**/*"

        paths:
            - shared/
# Modern GitHub integration (replaces deprecated github_checks)
github_checks:
    annotations: true

parsers:
    cobertura:
        handle_missing_conditions: true # Better error handling

        partials_as_hits: false # Default setting for Cobertura reports
    gcov:
        branch_detection:
            conditional: true # Track if/else branches
            loop: true # Track loop branches
            macro: false # Don't track macro expansions
            method: false # Don't track method entry/exit
    javascript:
        enable_partials: true # Enhanced for modern JS/TS projects
    v1:
        include_full_missed_files: true # Show files with 0% coverage
# Modern Slack integration
slack_app: false # Set to true to enable Codecov Slack App notifications

# Enhanced component management with domain-driven design principles
