# Codecov configuration for Uptime Watcher
# See: https://docs.codecov.com/docs/codecov-yaml

codecov:
    require_ci_to_pass: true
    notify:
        wait_for_ci: true
    branch: main
    max_report_age: 24 # Reject reports older than 24 hours
    # Flag collision resolution - prioritize explicit flags over defaults
    flag_management:
        default_rules:
            carryforward: false
        individual_flags:
            - name: frontend
              carryforward: false
            - name: electron
              carryforward: false

coverage:
    precision: 2
    round: down
    range: "70...100"

    # Prevent flag overlap by giving priority to path-based flags
    ignore_no_changes: true

    status:
        project:
            default:
                target: auto
                threshold: 1%
                base: auto
                # Only count files that don't have specific flag coverage
                only_pulls: false
            frontend:
                flags:
                    - frontend
                target: auto
                threshold: 1%
                paths:
                    - "src/"
            electron:
                flags:
                    - electron
                target: auto
                threshold: 1%
                paths:
                    - "electron/"
        patch:
            default:
                target: 70%
                threshold: 5%
                only_pulls: false
            frontend:
                flags:
                    - frontend
                target: 70%
                threshold: 5%
                paths:
                    - "src/"
            electron:
                flags:
                    - electron
                target: 70%
                threshold: 5%
                paths:
                    - "electron/"

    ignore:
        # Build outputs and compiled files
        - "dist/**/*"
        - "dist-electron/**/*"
        - "**/dist/**/*"
        - "electron/dist/**/*"

        # Development and configuration files
        - "coverage/**/*"
        - "release/**/*"
        - "scripts/**/*"
        - "docs/**/*"
        - "**/*.config.*"
        - "**/*.d.ts"
        - "**/node_modules/**/*"

        # Test files
        - "**/*.test.*"
        - "**/*.spec.*"
        - "**/test/**/*"
        - "src/test/**/*"
        - "electron/test/**/*"

        # Static assets
        - "public/**/*"
        - "icons/**/*"
        - "**/*.md"
        - "**/*.yml"
        - "**/*.yaml"
        - "**/*.json"

comment:
    layout: "header, flags, diff, tree, files, reach, betaprofiling, components, footer, feedback"
    behavior: default
    require_changes: false
    require_base: false # Allow comments on first PR
    require_head: true # Require head report to comment

flags:
    frontend:
        paths:
            - src/
        carryforward: false
        ignore:
            - "src/**/*.test.*"
            - "src/**/*.spec.*"
            - "src/test/**/*"
    electron:
        paths:
            - electron/
        carryforward: false
        ignore:
            - "electron/**/*.test.*"
            - "electron/**/*.spec.*"
            - "electron/test/**/*"

github_checks:
    annotations: true

parsers:
    javascript:
        enable_partials: yes # default yes
    v1:
        include_full_missed_files: true # Show files with 0% coverage
    gcov:
        branch_detection:
            conditional: yes # Track if/else branches
            loop: yes # Track loop branches
            method: no # Don't track method entry/exit
            macro: no # Don't track macro expansions

# Components configuration for logical domain separation
component_management:
    default_rules:
        statuses:
            - type: project
              target: auto
              threshold: 1%
              branches:
                  - "!main"
    individual_components:
        # Frontend Architecture Components
        - component_id: frontend_ui_components
          name: "UI Components"
          paths:
              - src/components/**
          statuses:
              - type: project
                target: 80%
                threshold: 2%
              - type: patch
                target: 75%
                threshold: 5%

        - component_id: frontend_state_management
          name: "State Management (Stores)"
          paths:
              - src/stores/**
          statuses:
              - type: project
                target: 85%
                threshold: 2%
              - type: patch
                target: 80%
                threshold: 5%

        - component_id: frontend_services
          name: "Frontend Services"
          paths:
              - src/services/**
          statuses:
              - type: project
                target: 80%
                threshold: 2%
              - type: patch
                target: 75%
                threshold: 5%

        - component_id: frontend_hooks
          name: "React Hooks"
          paths:
              - src/hooks/**
          statuses:
              - type: project
                target: 80%
                threshold: 2%
              - type: patch
                target: 75%
                threshold: 5%

        - component_id: frontend_utils
          name: "Frontend Utils"
          paths:
              - src/utils/**
          statuses:
              - type: project
                target: 85%
                threshold: 2%
              - type: patch
                target: 80%
                threshold: 5%

        # Backend Architecture Components
        - component_id: backend_core_services
          name: "Core Backend Services"
          paths:
              - electron/services/**
          statuses:
              - type: project
                target: 90%
                threshold: 2%
              - type: patch
                target: 85%
                threshold: 5%

        - component_id: backend_managers
          name: "Domain Managers"
          paths:
              - electron/managers/**
          statuses:
              - type: project
                target: 90%
                threshold: 2%
              - type: patch
                target: 85%
                threshold: 5%

        - component_id: backend_orchestrator
          name: "Uptime Orchestrator"
          paths:
              - electron/UptimeOrchestrator.ts
          statuses:
              - type: project
                target: 95%
                threshold: 2%
              - type: patch
                target: 90%
                threshold: 5%

        - component_id: backend_utils
          name: "Backend Utils"
          paths:
              - electron/utils/**
              - electron/electronUtils.ts
          statuses:
              - type: project
                target: 85%
                threshold: 2%
              - type: patch
                target: 80%
                threshold: 5%

        # Domain-Specific Components
        - component_id: database_layer
          name: "Database Layer"
          paths:
              - electron/services/database/**
              - electron/managers/DatabaseManager.ts
          statuses:
              - type: project
                target: 95%
                threshold: 1%
              - type: patch
                target: 90%
                threshold: 3%

        - component_id: monitoring_engine
          name: "Monitoring Engine"
          paths:
              - electron/services/monitoring/**
              - electron/managers/MonitorManager.ts
          statuses:
              - type: project
                target: 90%
                threshold: 2%
              - type: patch
                target: 85%
                threshold: 5%

        - component_id: ipc_communication
          name: "IPC Communication"
          paths:
              - electron/services/ipc/**
              - electron/preload.ts
          statuses:
              - type: project
                target: 90%
                threshold: 2%
              - type: patch
                target: 85%
                threshold: 5%

        - component_id: site_management
          name: "Site Management"
          paths:
              - electron/managers/SiteManager.ts
              - src/stores/sites/**
              - src/components/AddSiteForm/**
              - src/components/SiteDetails/**
          statuses:
              - type: project
                target: 85%
                threshold: 2%
              - type: patch
                target: 80%
                threshold: 5%

        - component_id: settings_configuration
          name: "Settings & Configuration"
          paths:
              - electron/managers/ConfigurationManager.ts
              - src/stores/settings/**
              - src/components/Settings/**
          statuses:
              - type: project
                target: 85%
                threshold: 2%
              - type: patch
                target: 80%
                threshold: 5%

        - component_id: dashboard_analytics
          name: "Dashboard & Analytics"
          paths:
              - src/components/Dashboard/**
              - src/stores/stats/**
              - src/stores/ui/**
          statuses:
              - type: project
                target: 80%
                threshold: 2%
              - type: patch
                target: 75%
                threshold: 5%

        - component_id: error_handling
          name: "Error Handling"
          paths:
              - src/stores/error/**
          statuses:
              - type: project
                target: 90%
                threshold: 2%
              - type: patch
                target: 85%
                threshold: 5%

        - component_id: theme_system
          name: "Theme System"
          paths:
              - src/theme/**
          statuses:
              - type: project
                target: 75%
                threshold: 3%
              - type: patch
                target: 70%
                threshold: 5%

        # Cross-Cutting Components
        - component_id: type_definitions
          name: "Type Definitions"
          paths:
              - src/types.ts
              - electron/types.ts
              - src/stores/types.ts
          statuses:
              - type: project
                target: 70%
                threshold: 5%
              - type: patch
                target: 65%
                threshold: 10%

        - component_id: constants
          name: "Constants"
          paths:
              - src/constants.ts
              - electron/constants.ts
          statuses:
              - type: project
                target: 70%
                threshold: 5%
              - type: patch
                target: 65%
                threshold: 10%
