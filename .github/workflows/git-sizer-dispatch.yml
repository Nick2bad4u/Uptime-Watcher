# yaml-language-server: $schema=https://www.schemastore.org/github-workflow.json
name: Analyze Repo with git-sizer
run-name: Analyze Repo with git-sizer - ${{ github.event.inputs.repo }}

on:
    workflow_dispatch:
        inputs:
            repo:
                description: "Repository to analyze (e.g., https://github.com/owner/repo.git)"
                required: true

jobs:
    run-git-sizer:
        name: git-sizer - ${{ github.event.inputs.repo }}
        runs-on: ubuntu-latest
        steps:
            - name: Harden the runner (Audit all outbound calls)
              uses: step-security/harden-runner@5ef0c079ce82195b2a36a210272d6b661572d83e # v2.14.2
              with:
                  egress-policy: audit

            - name: Checkout code
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

            - name: Use local git-sizer action
              id: sizer
              uses: ChrisCarini/github-git-sizer-action@09eaa4ae73038a5f0bbdc7e7b964f1bf6114c277 # latest
              with:
                  repo: ${{ github.event.inputs.repo }}
                  flags: "--threshold=0"

            - name: Print git-sizer output
              run: |
                  printf "%s\n" "${{ steps.sizer.outputs.result }}"
